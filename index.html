<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–ª–µ–º–µ–Ω—Ç–∞–ª–∏: –°–ª–∏—è–Ω–∏–µ –°—Ç–∏—Ö–∏–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        header {
            text-align: center;
            padding: 15px 0;
            width: 100%;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            background: linear-gradient(to right, #ff9a00, #ff2e63);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1rem;
            color: #a0a0c0;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 15px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .energy-container, .level-container, .score-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .energy-container {
            color: #ffcc00;
        }

        .level-container {
            color: #4cd964;
        }

        .score-container {
            color: #5ac8fa;
        }

        .value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .label {
            font-size: 0.8rem;
            margin-top: 3px;
        }

        .game-area {
            width: 100%;
            position: relative;
        }

        #gameCanvas {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            touch-action: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-energy {
            background: linear-gradient(135deg, #ffcc00, #ff9500);
            color: #fff;
        }

        .btn-shop {
            background: linear-gradient(135deg, #5ac8fa, #007aff);
            color: #fff;
        }

        .btn-help {
            background: linear-gradient(135deg, #4cd964, #34c759);
            color: #fff;
        }

        .epic-items {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .epic-items h2 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            text-align: center;
            color: #ffcc00;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .item:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }

        .item-icon {
            font-size: 1.8rem;
        }

        .item-name {
            font-size: 0.8rem;
            text-align: center;
        }

        .item-cost {
            font-size: 0.7rem;
            color: #ffcc00;
        }

        .combo-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 700px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .items-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–≠–ª–µ–º–µ–Ω—Ç–∞–ª–∏: –°–ª–∏—è–Ω–∏–µ –°—Ç–∏—Ö–∏–π</h1>
            <p class="subtitle">–°–æ–±–∏—Ä–∞–π —Ä—É–Ω—ã, —Å–æ–∑–¥–∞–≤–∞–π —ç–ª–µ–º–µ–Ω—Ç–∞–ª–µ–π –∏ –ø–æ–±–µ–∂–¥–∞–π!</p>
        </header>
        
        <div class="game-info">
            <div class="energy-container">
                <div class="value" id="energyValue">150</div>
                <div class="label">–≠–ù–ï–†–ì–ò–Ø</div>
            </div>
            <div class="level-container">
                <div class="value" id="levelValue">5</div>
                <div class="label">–£–†–û–í–ï–ù–¨</div>
            </div>
            <div class="score-container">
                <div class="value" id="scoreValue">2450</div>
                <div class="label">–û–ß–ö–ò</div>
            </div>
        </div>
        
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
            <div class="combo-display" id="comboDisplay">–ö–æ–º–±–æ x3!</div>
        </div>
        
        <div class="controls">
            <button class="btn-energy" id="energyBtn">–≠–ù–ï–†–ì–ò–Ø</button>
            <button class="btn-shop" id="shopBtn">–ú–ê–ì–ê–ó–ò–ù</button>
            <button class="btn-help" id="helpBtn">–ü–û–ú–û–©–¨</button>
        </div>
        
        <div class="epic-items">
            <h2>–≠–ü–ò–ß–ï–°–ö–ò–ï –ü–†–ï–î–ú–ï–¢–´</h2>
            <div class="items-grid">
                <div class="item" data-cost="50">
                    <div class="item-icon">üî•</div>
                    <div class="item-name">–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä</div>
                    <div class="item-cost">50 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <div class="item" data-cost="75">
                    <div class="item-icon">üíß</div>
                    <div class="item-name">–í–æ–¥–Ω—ã–π —â–∏—Ç</div>
                    <div class="item-cost">75 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <div class="item" data-cost="100">
                    <div class="item-icon">üå™Ô∏è</div>
                    <div class="item-name">–í–∏—Ö—Ä—å</div>
                    <div class="item-cost">100 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <div class="item" data-cost="120">
                    <div class="item-icon">‚ö°</div>
                    <div class="item-name">–ú–æ–ª–Ω–∏—è</div>
                    <div class="item-cost">120 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <div class="item" data-cost="150">
                    <div class="item-icon">üíé</div>
                    <div class="item-name">–ö—Ä–∏—Å—Ç–∞–ª–ª</div>
                    <div class="item-cost">150 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
                <div class="item" data-cost="200">
                    <div class="item-icon">üåÄ</div>
                    <div class="item-name">–ü–æ—Ä—Ç–∞–ª</div>
                    <div class="item-cost">200 —ç–Ω–µ—Ä–≥–∏–∏</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const energyValue = document.getElementById('energyValue');
            const levelValue = document.getElementById('levelValue');
            const scoreValue = document.getElementById('scoreValue');
            const comboDisplay = document.getElementById('comboDisplay');
            const energyBtn = document.getElementById('energyBtn');
            const shopBtn = document.getElementById('shopBtn');
            const helpBtn = document.getElementById('helpBtn');
            const items = document.querySelectorAll('.item');
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
            let energy = 150;
            let level = 5;
            let score = 2450;
            let selectedRune = null;
            let runes = [];
            let boardSize = 6;
            let cellSize = 0;
            let comboCount = 0;
            
            // –¢–∏–ø—ã —Ä—É–Ω
            const runeTypes = [
                { id: 'fire', name: '–û–≥–æ–Ω—å', color: '#ff416c', symbol: 'üî•', combo: '–û–≥–Ω–µ–Ω–Ω—ã–π –í–∏—Ö—Ä—å' },
                { id: 'water', name: '–í–æ–¥–∞', color: '#2193b0', symbol: 'üíß', combo: '–í–æ–¥—è–Ω–æ–π –©–∏—Ç' },
                { id: 'earth', name: '–ó–µ–º–ª—è', color: '#834d9b', symbol: 'üåç', combo: '–ö–∞–º–µ–Ω–Ω—ã–π –ì–æ–ª–µ–º' },
                { id: 'air', name: '–í–æ–∑–¥—É—Ö', color: '#56ccf2', symbol: 'üí®', combo: '–í–æ–∑–¥—É—à–Ω—ã–π –ü–æ—Ç–æ–∫' },
                { id: 'light', name: '–°–≤–µ—Ç', color: '#f9d423', symbol: '‚ú®', combo: '–ò—Å—Ü–µ–ª—è—é—â–∏–π –°–≤–µ—Ç' },
                { id: 'dark', name: '–¢—å–º–∞', color: '#434343', symbol: 'üåë', combo: '–¢–µ–º–Ω—ã–π –ü–æ—Ä—Ç–∞–ª' }
            ];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
            function initGame() {
                resizeCanvas();
                createRunes();
                drawGame();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                updateUI();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                window.addEventListener('resize', resizeCanvas);
                canvas.addEventListener('mousedown', handleMouseDown);
                canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                energyBtn.addEventListener('click', function() {
                    addEnergy(25);
                    showMessage('+25 —ç–Ω–µ—Ä–≥–∏–∏!');
                });
                
                shopBtn.addEventListener('click', function() {
                    showMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω!');
                });
                
                helpBtn.addEventListener('click', function() {
                    showMessage('–°–æ–±–∏—Ä–∞–π—Ç–µ 3+ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ä—É–Ω—ã –≤ —Ä—è–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞–ª–µ–π!');
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
                items.forEach(item => {
                    item.addEventListener('click', function() {
                        const itemName = this.querySelector('.item-name').textContent;
                        const itemCost = parseInt(this.getAttribute('data-cost'));
                        
                        if (energy >= itemCost) {
                            energy -= itemCost;
                            updateUI();
                            showMessage(`–í—ã –ø—Ä–∏–æ–±—Ä–µ–ª–∏ "${itemName}"!`);
                            this.classList.add('pulse');
                            setTimeout(() => {
                                this.classList.remove('pulse');
                            }, 500);
                        } else {
                            showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!');
                        }
                    });
                });
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Ä—É–Ω
            function createRunes() {
                runes = [];
                for (let row = 0; row < boardSize; row++) {
                    runes[row] = [];
                    for (let col = 0; col < boardSize; col++) {
                        const randomType = runeTypes[Math.floor(Math.random() * runeTypes.length)];
                        runes[row][col] = {
                            type: randomType,
                            row: row,
                            col: col,
                            x: col * cellSize,
                            y: row * cellSize
                        };
                    }
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä—ã
            function drawGame() {
                // –û—á–∏—â–∞–µ–º canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                
                for (let i = 0; i <= boardSize; i++) {
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                    ctx.beginPath();
                    ctx.moveTo(i * cellSize, 0);
                    ctx.lineTo(i * cellSize, canvas.height);
                    ctx.stroke();
                    
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                    ctx.beginPath();
                    ctx.moveTo(0, i * cellSize);
                    ctx.lineTo(canvas.width, i * cellSize);
                    ctx.stroke();
                }
                
                // –†–∏—Å—É–µ–º —Ä—É–Ω—ã
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        const rune = runes[row][col];
                        if (rune) {
                            drawRune(rune, col * cellSize, row * cellSize, cellSize);
                        }
                    }
                }
                
                // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ä—É–Ω–∞, –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –µ—ë
                if (selectedRune) {
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(
                        selectedRune.col * cellSize + 2,
                        selectedRune.row * cellSize + 2,
                        cellSize - 4,
                        cellSize - 4
                    );
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä—É–Ω—ã
            function drawRune(rune, x, y, size) {
                const padding = size * 0.1;
                const centerX = x + size / 2;
                const centerY = y + size / 2;
                
                // –†–∏—Å—É–µ–º —Ñ–æ–Ω —Ä—É–Ω—ã
                const gradient = ctx.createLinearGradient(x, y, x + size, y + size);
                gradient.addColorStop(0, rune.type.color);
                gradient.addColorStop(1, darkenColor(rune.type.color, 20));
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x + padding, y + padding, size - padding * 2, size - padding * 2, 10);
                ctx.fill();
                
                // –†–∏—Å—É–µ–º —Å–∏–º–≤–æ–ª —Ä—É–Ω—ã
                ctx.font = `${size * 0.5}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = '#ffffff';
                ctx.fillText(rune.type.symbol, centerX, centerY);
            }
            
            // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞
            function darkenColor(color, percent) {
                const num = parseInt(color.slice(1), 16);
                const amt = Math.round(2.55 * percent);
                const R = (num >> 16) - amt;
                const G = (num >> 8 & 0x00FF) - amt;
                const B = (num & 0x0000FF) - amt;
                return `#${(0x1000000 + (R < 0 ? 0 : R) * 0x10000 + (G < 0 ? 0 : G) * 0x100 + (B < 0 ? 0 : B)).toString(16).slice(1)}`;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –º—ã—à–∏
            function handleMouseDown(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                handleInput(x, y);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏—è
            function handleTouchStart(e) {
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const touch = e.touches[0];
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                handleInput(x, y);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞
            function handleInput(x, y) {
                const col = Math.floor(x / cellSize);
                const row = Math.floor(y / cellSize);
                
                if (row >= 0 && row < boardSize && col >= 0 && col < boardSize) {
                    const rune = runes[row][col];
                    
                    if (selectedRune) {
                        // –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Ä—É–Ω–∞, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–º–µ–Ω—è—Ç—å –∏—Ö –º–µ—Å—Ç–∞–º–∏
                        if (isAdjacent(selectedRune, rune)) {
                            swapRunes(selectedRune, rune);
                            checkMatches();
                        }
                        selectedRune = null;
                    } else {
                        // –í—ã–±–∏—Ä–∞–µ–º —Ä—É–Ω—É
                        selectedRune = rune;
                    }
                    
                    drawGame();
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —Ä—É–Ω—ã —Å–æ—Å–µ–¥–Ω–∏–º–∏
            function isAdjacent(rune1, rune2) {
                return (
                    (Math.abs(rune1.row - rune2.row) === 1 && rune1.col === rune2.col) ||
                    (Math.abs(rune1.col - rune2.col) === 1 && rune1.row === rune2.row)
                );
            }
            
            // –û–±–º–µ–Ω —Ä—É–Ω–∞–º–∏
            function swapRunes(rune1, rune2) {
                // –ú–µ–Ω—è–µ–º —Ä—É–Ω—ã –º–µ—Å—Ç–∞–º–∏ –≤ –º–∞—Å—Å–∏–≤–µ
                [runes[rune1.row][rune1.col], runes[rune2.row][rune2.col]] = 
                [runes[rune2.row][rune2.col], runes[rune1.row][rune1.col]];
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏
                const tempRow = rune1.row;
                const tempCol = rune1.col;
                
                rune1.row = rune2.row;
                rune1.col = rune2.col;
                
                rune2.row = tempRow;
                rune2.col = tempCol;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            function checkMatches() {
                let hasMatches = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize - 2; col++) {
                        const rune1 = runes[row][col];
                        const rune2 = runes[row][col + 1];
                        const rune3 = runes[row][col + 2];
                        
                        if (rune1 && rune2 && rune3 && 
                            rune1.type.id === rune2.type.id && 
                            rune1.type.id === rune3.type.id) {
                            
                            // –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                            hasMatches = true;
                            comboCount++;
                            
                            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—á–∫–∏ –∏ —ç–Ω–µ—Ä–≥–∏—é
                            score += 100 * comboCount;
                            addEnergy(10);
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–±–æ
                            showCombo(comboCount, rune1.type);
                            
                            // –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Ä—É–Ω—ã
                            runes[row][col] = null;
                            runes[row][col + 1] = null;
                            runes[row][col + 2] = null;
                            
                            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–∑–º–æ–∂–Ω–æ–π –≥—Ä—É–ø–ø–µ
                            col += 2;
                        }
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                for (let col = 0; col < boardSize; col++) {
                    for (let row = 0; row < boardSize - 2; row++) {
                        const rune1 = runes[row][col];
                        const rune2 = runes[row + 1][col];
                        const rune3 = runes[row + 2][col];
                        
                        if (rune1 && rune2 && rune3 && 
                            rune1.type.id === rune2.type.id && 
                            rune1.type.id === rune3.type.id) {
                            
                            // –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                            hasMatches = true;
                            comboCount++;
                            
                            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ—á–∫–∏ –∏ —ç–Ω–µ—Ä–≥–∏—é
                            score += 100 * comboCount;
                            addEnergy(10);
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–º–±–æ
                            showCombo(comboCount, rune1.type);
                            
                            // –£–¥–∞–ª—è–µ–º —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Ä—É–Ω—ã
                            runes[row][col] = null;
                            runes[row + 1][col] = null;
                            runes[row + 2][col] = null;
                            
                            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–∑–º–æ–∂–Ω–æ–π –≥—Ä—É–ø–ø–µ
                            row += 2;
                        }
                    }
                }
                
                if (hasMatches) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    updateUI();
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞ –Ω–æ–≤—ã–º–∏ —Ä—É–Ω–∞–º–∏
                    fillEmptySpaces();
                    
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∏–≥—Ä—É
                    drawGame();
                    
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
                    setTimeout(() => {
                        checkMatches();
                    }, 500);
                } else {
                    comboCount = 0;
                }
            }
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö –º–µ—Å—Ç
            function fillEmptySpaces() {
                for (let col = 0; col < boardSize; col++) {
                    let emptySpaces = 0;
                    
                    // –°—á–∏—Ç–∞–µ–º –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–ª–æ–Ω–∫–µ —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
                    for (let row = boardSize - 1; row >= 0; row--) {
                        if (!runes[row][col]) {
                            emptySpaces++;
                        } else if (emptySpaces > 0) {
                            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ä—É–Ω—É –≤–Ω–∏–∑
                            runes[row + emptySpaces][col] = runes[row][col];
                            runes[row][col] = null;
                            runes[row + emptySpaces][col].row = row + emptySpaces;
                        }
                    }
                    
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤–µ—Ä—Ö–Ω–∏–µ –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞ –Ω–æ–≤—ã–º–∏ —Ä—É–Ω–∞–º–∏
                    for (let row = 0; row < emptySpaces; row++) {
                        const randomType = runeTypes[Math.floor(Math.random() * runeTypes.length)];
                        runes[row][col] = {
                            type: randomType,
                            row: row,
                            col: col,
                            x: col * cellSize,
                            y: row * cellSize
                        };
                    }
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–±–æ
            function showCombo(count, runeType) {
                comboDisplay.textContent = `–ö–æ–º–±–æ x${count}! ${runeType.combo}`;
                comboDisplay.style.display = 'block';
                comboDisplay.classList.add('fade-in');
                
                setTimeout(() => {
                    comboDisplay.classList.remove('fade-in');
                    comboDisplay.style.display = 'none';
                }, 2000);
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
            function showMessage(message) {
                // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Å–∏–≤—ã–π toast
                alert(message);
            }
            
            // –î–æ–±–∞–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é
            function addEnergy(amount) {
                energy += amount;
                updateUI();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            function updateUI() {
                energyValue.textContent = energy;
                levelValue.textContent = level;
                scoreValue.textContent = score;
            }
            
            // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ canvas
            function resizeCanvas() {
                const container = canvas.parentElement;
                const size = Math.min(container.offsetWidth, 500);
                
                canvas.width = size;
                canvas.height = size;
                
                cellSize = size / boardSize;
                
                drawGame();
            }
            
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
            initGame();
        });
    </script>
</body>
</html>
